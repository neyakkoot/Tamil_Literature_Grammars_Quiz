<!DOCTYPE html>
<html lang="ta">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>родрооро┐ро┤рпНроХрпН роХро│роЮрпНроЪро┐ропроорпН ро╡ро┐ройро╛роЯро┐тАУро╡ро┐ройро╛</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Tamil&display=swap" rel="stylesheet">

<style>
  body {
    font-family: 'Noto Sans Tamil', sans-serif;
    margin: 0;
    background: #f5f7fb;
    color: #222;
  }
  .hidden { display: none !important; }
  #login-container {
    max-width: 500px;
    margin: 100px auto;
    padding: 30px;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 4px 14px rgba(0, 0, 0, 0.08);
    text-align: center;
  }
  #login-container h2 { color: #007bff; }
  #username-input {
    width: 90%;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 1rem;
    margin-top: 10px;
  }
  #login-btn {
    padding: 12px 25px;
    border-radius: 8px;
    border: none;
    font-weight: 700;
    cursor: pointer;
    color: #fff;
    background: #28a745;
    font-size: 1rem;
    margin-top: 20px;
    transition: background 0.3s;
  }
  #login-btn:hover { background: #218838; }
  #dashboard-container {
    max-width: 1000px;
    margin: 20px auto;
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 14px rgba(0, 0, 0, 0.08);
  }
  #dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 2px solid #007bff;
    padding-bottom: 10px;
    margin-bottom: 20px;
  }
  #dashboard-header h2 { color: #007bff; margin: 0; }
  #logout-btn {
    padding: 8px 15px;
    border: none;
    border-radius: 6px;
    background: #dc3545;
    color: white;
    font-weight: 700;
    cursor: pointer;
  }
  #dashboard-stats {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
    text-align: center;
  }
  .stat-card {
    flex: 1;
    background: #f4f4f4;
    padding: 15px;
    border-radius: 8px;
  }
  .stat-card h4 { margin: 0 0 5px 0; color: #555; }
  .stat-card p { margin: 0; font-size: 1.5rem; font-weight: 700; color: #007bff; }
  #dashboard-history table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }
  #dashboard-history th, #dashboard-history td {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: left;
  }
  #dashboard-history th { background-color: #f2f2f2; color: #333; }
  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: linear-gradient(90deg, #007bff, #00b894);
    color: white;
    padding: 12px 20px;
    border-bottom: 4px solid #0a58ca;
  }
  .header h1 { margin: 0; font-size: 1.6rem; text-align: center; }
  .header p { margin: 4px 0 0; font-size: 1rem; text-align: center; }
  .header img {
    width: 90px;
    height: 90px;
    border-radius: 50%;
    border: 2px solid #fff;
    background: white;
    object-fit: cover;
  }
  @media (max-width: 768px) {
    .header { flex-direction: column; text-align: center; }
    .header img { width: 70px; height: 70px; margin: 6px 0; }
  }
  #tv-quiz-wrap {
    max-width: 1000px;
    margin: 30px auto;
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 14px rgba(0, 0, 0, 0.08);
    display: grid;
    grid-template-columns: 1fr 320px;
    gap: 20px;
  }
  @media (max-width: 900px) { #tv-quiz-wrap { grid-template-columns: 1fr; } }
  #tv-main { display: flex; flex-direction: column; }
  #quizSelect {
    display: block;
    width: 100%;
    margin-bottom: 15px;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 1rem;
    background: #fefefe;
  }
  #tv-progress {
    text-align: center;
    font-weight: 700;
    color: #555;
    background: #eef4ff;
    padding: 8px;
    border-radius: 6px;
    margin-bottom: 12px;
  }
  #tv-question {
    font-size: 1.15rem;
    font-weight: 700;
    line-height: 1.5;
    margin-bottom: 12px;
  }
  #tv-options { display: flex; flex-direction: column; gap: 10px; }
  .option-btn {
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #ddd;
    background: #f9f9f9;
    text-align: left;
    cursor: pointer;
    font-size: 1rem;
    transition: all 0.2s ease-in-out;
  }
  .option-btn:hover { background: #e7f0ff; }
  .option-btn.correct { background: #e6f7e9; border-color: #28a745; }
  .option-btn.wrong { background: #fdecea; border-color: #dc3545; }
  #tv-feedback {
    display: none;
    margin-top: 14px;
    padding: 12px;
    border-radius: 8px;
    background: #f9f9f9;
    border: 1px solid #ddd;
  }
  #tv-side {
    background: #f5fcf8;
    border: 1px solid #cce5d3;
    border-radius: 10px;
    padding: 15px;
    font-size: 0.95rem;
    display: flex;
    flex-direction: column;
  }
  #tv-side h3 { color: #006644; margin-top: 0; }
  .quiz-nav {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
  }
  #tv-prev, #tv-next {
    padding: 10px 16px;
    border-radius: 8px;
    border: none;
    font-weight: 700;
    cursor: pointer;
    color: #fff;
  }
  #tv-prev { background: #ff9800; }
  #tv-next { background: #007bff; }
  #tv-results {
    display: none;
    margin-top: 18px;
    text-align: center;
    border-top: 2px solid #007bff;
    padding-top: 20px;
  }
  #tv-timer-box {
    text-align: center;
    background: #fff;
    border: 2px solid #007bff;
    border-radius: 8px;
    padding: 10px;
    margin-top: 15px;
    order: -1; 
  }
  #tv-timer-box h3 {
    margin: 0 0 10px 0;
    color: #007bff;
    font-size: 1.1rem;
  }
  #tv-timer-display {
    font-size: 2.2rem;
    font-weight: 700;
    color: #333;
    letter-spacing: 2px;
  }
  #tv-timer-display.warning {
    color: #dc3545;
    animation: pulse 1.2s infinite;
  }
  @keyframes pulse {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.05); opacity: 0.7; }
    100% { transform: scale(1); opacity: 1; }
  }
  #tv-result-title { font-size: 1.8rem; font-weight: 700; color: #28a745; }
  #tv-result-score { font-size: 1.4rem; font-weight: 700; color: #007bff; margin: 10px 0; }
  #tv-result-percentage { font-size: 1.2rem; font-weight: 700; color: #555; margin: 5px 0 15px 0; }
  #tv-result-message {
    font-size: 1.1rem;
    font-style: italic;
    color: #333;
    margin-top: 15px;
    background: #f4f4f4;
    padding: 10px;
    border-radius: 6px;
  }
  #tv-restart-btn {
    padding: 12px 20px;
    border-radius: 8px;
    border: none;
    font-weight: 700;
    cursor: pointer;
    color: #fff;
    background: #28a745;
    font-size: 1rem;
    margin-top: 20px;
    transition: background 0.3s;
  }
  #tv-restart-btn:hover { background: #218838; }
</style>
</head>
<body>

  <div id="login-container">
    <h2>ЁЯСЛ ро╡рогроХрпНроХроорпН!ЁЯУЪ</h2>
    <p>ро╡ро┐ройро╛роЯро┐-ро╡ро┐ройро╛ родрпКроЯроЩрпНроХрпБроорпН роорпБройрпН, роЙроЩрпНроХро│рпН рокрпЖропро░рпИрокрпН рокродро┐ро╡рпБ роЪрпЖропрпНропро╡рпБроорпН.</p>
    <input type="text" id="username-input" placeholder="роЙроЩрпНроХро│рпН рокрпЖропро░рпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН">
    <button id="login-btn">роЙро│рпНроирпБро┤рпИ</button>
  </div>

  <main id="app-container" class="hidden">

    <div class="header">
      <img src="images/родро┐ро░рпБро╡ро│рпНро│рпБро╡ро░рпН.jpg" alt="родро┐ро░рпБро╡ро│рпНро│рпБро╡ро░рпН">
      <div>
        <h1>родрооро┐ро┤рпНрокрпН рокрпЛроЯрпНроЯро┐родрпН родрпЗро░рпНро╡рпБ ро╡ро┐ройро╛роЯро┐тАУро╡ро┐ройро╛</h1>
        <p>ЁЯУЪ родрпЗро░рпНроирпНродрпЖроЯрпБродрпНродрпБ роорпБропро▒рпНроЪро┐ роЪрпЖропрпНродрпБ роЙроЩрпНроХро│рпН роЕро▒ро┐ро╡рпИроЪрпН роЪрпЛродро┐роХрпНроХро▓ро╛роорпН ЁЯУЪ</p>
      </div>
      <img src="images/родрпКро▓рпНроХро╛рокрпНрокро┐ропро░рпН.jpg" alt="родрпКро▓рпНроХро╛рокрпНрокро┐ропро░рпН">
    </div>

    <div id="dashboard-container">
      <div id="dashboard-header">
        <h2 id="welcome-message">ЁЯУИ роОройрпН роорпБропро▒рпНроЪро┐роХро│рпБроорпН роХро▒рпНро▒ро▓рпН рокродро┐ро╡рпБроХро│рпБроорпН</h2>
        <button id="logout-btn" title="Clear all data and logout">ро╡рпЖро│ро┐ропрпЗро▒рпБ</button>
      </div>
      <div id="dashboard-stats">
        <div class="stat-card">
          <h4>роорпКродрпНрод рокропро┐ро▒рпНроЪро┐роХро│рпН</h4>
          <p id="stat-total-attempts">0</p>
        </div>
        <div class="stat-card">
          <h4>роЪро░ро╛роЪро░ро┐ роородро┐рокрпНрокрпЖрогрпН</h4>
          <p id="stat-avg-score">0%</p>
        </div>
      </div>
      <div id="dashboard-history">
        <h3 style="text-align: center;">рокропро┐ро▒рпНроЪро┐ ро╡ро░ро▓ро╛ро▒рпБ</h3>
        <table id="history-table">
          <thead>
            <tr>
              <th>родрпЗродро┐</th>
              <th>ро╡ро┐ройро╛роЯро┐-ро╡ро┐ройро╛</th>
              <th>роородро┐рокрпНрокрпЖрогрпН</th>
            </tr>
          </thead>
          <tbody id="history-table-body">
          </tbody>
        </table>
        <p id="no-history-msg" style="text-align: center; display: none;">роирпАроЩрпНроХро│рпН роЗройрпНройрпБроорпН роОроирпНродрокрпН рокропро┐ро▒рпНроЪро┐ропрпБроорпН роОроЯрпБроХрпНроХро╡ро┐ро▓рпНро▓рпИ.</p>
      </div>
    </div>

    <div id="tv-quiz-wrap">
      <div id="tv-main">
        <select id="quizSelect">
          <option value="" disabled selected>ЁЯза ро╡ро┐ройро╛роЯро┐тАУро╡ро┐ройро╛ родрпКроХрпБрокрпНрокрпИродрпН родрпЖро░ро┐ро╡рпБроЪрпЖропрпНроХ</option>
        </select>
        <div id="tv-progress"></div>
        <div id="tv-question"></div>
        <div id="tv-options"></div>
        <div id="tv-feedback"></div>
        <div class="quiz-nav">
          <button id="tv-prev" style="display:none;">ЁЯСИтЭУ роорпБроирпНродрпИроп ро╡ро┐ройро╛</button>
          <button id="tv-next" style="display:none;">роЕроЯрпБродрпНрод ро╡ро┐ройро╛ ЁЯСЙтЭУ</button>
        </div>
        <div id="tv-results">
          <h2 id="tv-result-title">ЁЯОЙ ро╡ро╛ро┤рпНродрпНродрпБроХрпНроХро│рпН! ЁЯОЙ</h2>
          <p id="tv-result-score">роЙроЩрпНроХро│рпН роородро┐рокрпНрокрпЖрогрпН: 0 / 0</p>
          <p id="tv-result-percentage">ро╡ро┐ро┤рпБроХрпНроХро╛роЯрпБ: 0%</p>
          <p id="tv-result-message">роЙроЩрпНроХро│рпН роКроХрпНроХроЪрпН роЪрпЖропрпНродро┐ роЗроЩрпНроХрпЗ...</p>
          <button id="tv-restart-btn">рокрпБродро┐роп ро╡ро┐ройро╛роЯро┐-ро╡ро┐ройро╛ро╡рпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН ЁЯФБ</button>
        </div>
      </div>
      <div id="tv-side">
        <div id="tv-timer-box" style="display:none;">
          <h3>тП░ роирпЗро░роорпН роорпАродроорпБро│рпНро│родрпБ тП░</h3>
          <div id="tv-timer-display">00:00</div>
        </div>
        <h2>ЁЯСитАНЁЯТ╗ роЙро░рпБро╡ро╛роХрпНроХрпБроиро░рпН ЁЯСитАНЁЯТ╗</h2>
        <p>ЁЯСитАНЁЯТ╗ роорпБройрпИро╡ро░рпН роЪродрпНродро┐ропро░ро╛роЪрпБ родроЩрпНроХроЪрпНроЪро╛рооро┐, рокропро┐ро▒рпНро▒рпБроиро░рпН, родрооро┐ро┤рпНроиро╛роЯрпБ, роЗроирпНродро┐ропро╛ тЬНя╕П</p>
      </div>
    </div>

  </main> 


  <script src="js/quiz-loader.js"></script>
  <script src="js/footer-history.js"></script>

  <script>
    // --- ЁЯСС рокрпБродро┐роп рооро╛ро▒ро┐роХро│рпН ЁЯСС ---
    let inactivityTimer; // роЪрпЖропро▓рпНрокроЯро╛ роиро┐ро▓рпИ роирпЗро░роЩрпНроХро╛роЯрпНроЯро┐роХрпНроХро╛рой ID
    const INACTIVITY_MINUTES = 4; // 4 роиро┐рооро┐роЯроЩрпНроХро│рпН
    // --- ЁЯСС ---

    let timerInterval; // роЗродрпБ роПро▒рпНроХройро╡рпЗ роЙро│рпНро│родрпБ (роорпКродрпНрод ро╡ро┐ройро╛роЯро┐-ро╡ро┐ройро╛ роирпЗро░родрпНродро┐ро▒рпНроХрпБ)
    let totalSeconds;
    
    const loginContainer = document.getElementById('login-container');
    const appContainer = document.getElementById('app-container');
    const loginBtn = document.getElementById('login-btn');
    const usernameInput = document.getElementById('username-input');
    const logoutBtn = document.getElementById('logout-btn');
    const welcomeMessageEl = document.getElementById('welcome-message');
    const dashboardHistoryEl = document.getElementById('dashboard-history');
    const historyTableBodyEl = document.getElementById('history-table-body');
    const noHistoryMsgEl = document.getElementById('no-history-msg');
    const statTotalAttemptsEl = document.getElementById('stat-total-attempts');
    const statAvgScoreEl = document.getElementById('stat-avg-score');
    
    // --- ЁЯСС рокрпБродро┐роп роЪрпЖропро▓рпНрокро╛роЯрпБ 1: роЪрпЖропро▓рпНрокроЯро╛ роиро┐ро▓рпИ роирпЗро░роЩрпНроХро╛роЯрпНроЯро┐ропрпИ Reset роЪрпЖропрпН ЁЯСС ---
    /**
     * рокропройро░рпН роТро░рпБ роЪрпЖропро▓рпИроЪрпН (click) роЪрпЖропрпНродро╡рпБроЯройрпН роЗроирпНрод роирпЗро░роЩрпНроХро╛роЯрпНроЯро┐ропрпИ роорпАрогрпНроЯрпБроорпН родрпКроЯроЩрпНроХрпБроорпН.
     * (js/quiz-loader.js роЗро▓ро┐ро░рпБроирпНродрпБ роЗродрпБ роЕро┤рпИроХрпНроХрокрпНрокроЯрпБроорпН)
     */
    function resetInactivityTimer() {
      // роПро▒рпНроХройро╡рпЗ роЗропроЩрпНроХрпБроорпН роЯрпИрооро░рпИ роиро┐ро▒рпБродрпНродрпБ
      clearTimeout(inactivityTimer);

      // роТро░рпБ рокрпБродро┐роп 4 роиро┐рооро┐роЯ роирпЗро░роЩрпНроХро╛роЯрпНроЯро┐ропрпИродрпН родрпКроЯроЩрпНроХрпБ
      inactivityTimer = setTimeout(() => {
        // 4 роиро┐рооро┐роЯроЩрпНроХро│рпН роорпБроЯро┐роирпНродродрпБроорпН...
        alert(`роирпАроЩрпНроХро│рпН ${INACTIVITY_MINUTES} роиро┐рооро┐роЯроЩрпНроХро│ро╛роХроЪрпН роЪрпЖропро▓рпНрокроЯро╡ро┐ро▓рпНро▓рпИ. роОройро╡рпЗ, роЗроирпНрод ро╡ро┐ройро╛роЯро┐-ро╡ро┐ройро╛ родро╛ройро╛роХро╡рпЗ роорпБроЯро┐роХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ.`);
        
        // quiz-loader.js роЗро▓рпН роЙро│рпНро│ showResults() роР роЕро┤рпИроХрпНроХро╡рпБроорпН
        if (typeof showResults === 'function') {
          showResults();
        } else {
          console.error("showResults (from quiz-loader.js) not found for inactivity timeout!");
        }
      }, INACTIVITY_MINUTES * 60 * 1000); // рооро┐ро▓рпНро▓ро┐ ро╡ро┐роиро╛роЯро┐роХро│ро╛роХ рооро╛ро▒рпНро▒рпБ
    }

    // --- ЁЯСС рокрпБродро┐роп роЪрпЖропро▓рпНрокро╛роЯрпБ 2: роЪрпЖропро▓рпНрокроЯро╛ роиро┐ро▓рпИ роирпЗро░роЩрпНроХро╛роЯрпНроЯро┐ропрпИ роиро┐ро▒рпБродрпНродрпБ ЁЯСС ---
    /**
     * ро╡ро┐ройро╛роЯро┐-ро╡ро┐ройро╛ роорпБроЯро┐роирпНродродрпБроорпН роЕро▓рпНро▓родрпБ рокропройро░рпН ро╡рпЖро│ро┐ропрпЗро▒рпБроорпНрокрпЛродрпБроорпН роЗроирпНрод роирпЗро░роЩрпНроХро╛роЯрпНроЯро┐ропрпИ роорпБро┤рпБроорпИропро╛роХ роиро┐ро▒рпБродрпНродрпБ.
     */
    function stopInactivityTimer() {
      clearTimeout(inactivityTimer);
    }
    // --- ЁЯСС ---

    /**
     * ро╡ро┐ройро╛роЯро┐-ро╡ро┐ройро╛ роирпЗро░родрпНродрпИроХрпН роХрогроХрпНроХро┐роЯрпНроЯрпБродрпН родрпКроЯроЩрпНроХрпБроорпН роЪрпЖропро▓рпНрокро╛роЯрпБ
     */
    function startQuizTimer(questionCount) {
      stopTimer(); // роорпКродрпНрод роирпЗро░роЩрпНроХро╛роЯрпНроЯро┐ропрпИ роиро┐ро▒рпБродрпНродрпБ
      resetInactivityTimer(); // ЁЯСС роЪрпЖропро▓рпНрокроЯро╛ роиро┐ро▓рпИ роирпЗро░роЩрпНроХро╛роЯрпНроЯро┐ропрпИродрпН родрпКроЯроЩрпНроХрпБ / Reset роЪрпЖропрпН ЁЯСС
      
      const timerBox = document.getElementById('tv-timer-box');
      if (!timerBox) return;

      let totalMinutes = calculateMinutes(questionCount);
      totalSeconds = totalMinutes * 60;

      timerBox.style.display = 'block';
      updateTimerDisplay();

      timerInterval = setInterval(() => {
        totalSeconds--;
        updateTimerDisplay();

        if (totalSeconds <= 0) {
          stopTimer(); // роорпКродрпНрод роирпЗро░роЩрпНроХро╛роЯрпНроЯро┐ропрпИ роорпБроЯро┐роирпНродродрпБ
          stopInactivityTimer(); // ЁЯСС роЪрпЖропро▓рпНрокроЯро╛ роиро┐ро▓рпИ роирпЗро░роЩрпНроХро╛роЯрпНроЯро┐ропрпИ роиро┐ро▒рпБродрпНродрпБ ЁЯСС
          alert('роирпЗро░роорпН роорпБроЯро┐роирпНродродрпБ!');
          
          if (typeof showResults === 'function') {
            showResults();
          } else {
            console.error("showResults function (from quiz-loader.js) not found!");
            showCustomResults(0, 0, "Unspecified Quiz"); 
          }
        }
      }, 1000);
    }

    /**
     * роирпЗро░роЩрпНроХро╛роЯрпНроЯро┐ роХро╛роЯрпНроЪро┐ропрпИрокрпН рокрпБродрпБрокрпНрокро┐роХрпНроХрпБроорпН роЪрпЖропро▓рпНрокро╛роЯрпБ
     */
    function updateTimerDisplay() {
      const timerDisplay = document.getElementById('tv-timer-display');
      if (!timerDisplay) return;
      const minutes = Math.floor(totalSeconds / 60);
      const seconds = totalSeconds % 60;
      timerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
      if (totalSeconds <= 60 && !timerDisplay.classList.contains('warning')) {
        timerDisplay.classList.add('warning');
      } else if (totalSeconds > 60) {
        timerDisplay.classList.remove('warning');
      }
    }

    /**
     * роорпКродрпНрод роирпЗро░роЩрпНроХро╛роЯрпНроЯро┐ропрпИ роиро┐ро▒рпБродрпНродрпБроорпН роЪрпЖропро▓рпНрокро╛роЯрпБ
     */
    function stopTimer() {
      clearInterval(timerInterval);
      const timerDisplay = document.getElementById('tv-timer-display');
      if (timerDisplay) {
          timerDisplay.classList.remove('warning');
      }
    }

    /**
     * ро╡ро┐ройро╛роХрпНроХро│ро┐ройрпН роОрогрпНрогро┐роХрпНроХрпИроХрпНроХрпБ роПро▒рпНрок роиро┐рооро┐роЯроЩрпНроХро│рпИроХрпН роХрогроХрпНроХро┐роЯрпБродро▓рпН
     */
    function calculateMinutes(count) {
      if (count <= 0) return 0;
      if (count <= 25) return count; 
      else if (count > 50 && count <= 100) return 90; 
      else return Math.round(count * 0.9);
    }

    /**
     * роКроХрпНроХрооро│ро┐роХрпНроХрпБроорпН роЪрпЖропрпНродро┐ропрпИ ро╡ро┤роЩрпНроХрпБроорпН роЪрпЖропро▓рпНрокро╛роЯрпБ
     */
    function getMotivationalMessage(percentage) {
      if (percentage === 100) return "ЁЯТп роЕро░рпБроорпИ! роорпБро┤рпБроорпИропро╛рой роородро┐рокрпНрокрпЖрогрпН! роЙроЩрпНроХро│рпН роЙро┤рпИрокрпНрокрпБ роЕрокро╛ро░рооро╛ройродрпБ!";
      else if (percentage >= 90) return "ЁЯОЙ рооро┐роХ роиройрпНро▒рпБ! роЗро▓роХрпНроХрпИ роирпЖро░рпБроЩрпНроХро┐ро╡ро┐роЯрпНроЯрпАро░рпНроХро│рпН. роЙроЩрпНроХро│рпН роорпБропро▒рпНроЪро┐ рокро╛ро░ро╛роЯрпНроЯродрпНродроХрпНроХродрпБ!";
      else if (percentage >= 75) return "ЁЯСН роЪро┐ро▒рокрпНрокро╛роХроЪрпН роЪрпЖропрпНродрпАро░рпНроХро│рпН! роЗройрпНройрпБроорпН роЪро┐ро▒ро┐родрпБ роорпБропро▒рпНроЪро┐родрпНродро╛ро▓рпН роорпБро┤рпБ ро╡рпЖро▒рпНро▒ро┐ропрпИ роЕроЯрпИропро▓ро╛роорпН.";
      else if (percentage >= 50) return "ЁЯЩВ рокро░ро╡ро╛ропро┐ро▓рпНро▓рпИ, роиро▓рпНро▓ роорпБропро▒рпНроЪро┐. родрпКроЯро░рпНроирпНродрпБ рокропро┐ро▒рпНроЪро┐ роЪрпЖропрпНропрпБроЩрпНроХро│рпН, роиро┐роЪрпНроЪропроорпН ро╡рпЖро▓рпНро▓ро▓ро╛роорпН!";
      else if (percentage > 0) return "ЁЯТк роорпБропро▒рпНроЪро┐ родро┐ро░рпБро╡ро┐ройрпИропро╛роХрпНроХрпБроорпН! родро╡ро▒рпБроХро│рпИродрпН родро┐ро░рпБродрпНродро┐роХрпН роХрпКрогрпНроЯрпБ роорпАрогрпНроЯрпБроорпН роорпБропро▓рпБроЩрпНроХро│рпН.";
      else return "ЁЯМ▒ родрпКроЯроХрпНроХроорпН роЪро▒рпНро▒рпБроХрпН роХроЯро┐ройрооро╛роХ роЗро░рпБроХрпНроХро▓ро╛роорпН. рооройроорпН родро│ро░ ро╡рпЗрогрпНроЯро╛роорпН, родрпКроЯро░рпНроирпНродрпБ рокроЯро┐ропрпБроЩрпНроХро│рпН!";
    }

    /**
     * роорпЗроорпНрокроЯрпБродрпНродрокрпНрокроЯрпНроЯ роорпБроЯро┐ро╡рпБроХро│рпИроХрпН роХро╛роЯрпНроЯрпБроорпН роЪрпЖропро▓рпНрокро╛роЯрпБ
     */
    function showCustomResults(score, totalQuestions, quizTitle) {
      stopTimer(); // ЁЯСС роорпКродрпНрод роирпЗро░роЩрпНроХро╛роЯрпНроЯро┐ропрпИ роиро┐ро▒рпБродрпНродрпБ ЁЯСС
      stopInactivityTimer(); // ЁЯСС роЪрпЖропро▓рпНрокроЯро╛ роиро┐ро▓рпИ роирпЗро░роЩрпНроХро╛роЯрпНроЯро┐ропрпИ роиро┐ро▒рпБродрпНродрпБ ЁЯСС
      
      const timerBox = document.getElementById('tv-timer-box');
      if (timerBox) timerBox.style.display = 'none';

      document.getElementById('tv-progress').style.display = 'none';
      document.getElementById('tv-question').style.display = 'none';
      document.getElementById('tv-options').style.display = 'none';
      document.getElementById('tv-feedback').style.display = 'none';
      document.querySelector('.quiz-nav').style.display = 'none';

      const resultsContainer = document.getElementById('tv-results');
      const titleEl = document.getElementById('tv-result-title');
      const scoreEl = document.getElementById('tv-result-score');
      const percentageEl = document.getElementById('tv-result-percentage');
      const messageEl = document.getElementById('tv-result-message');
      
      if (!resultsContainer) return;

      const percentage = totalQuestions > 0 ? Math.round((score / totalQuestions) * 100) : 0;
      
      titleEl.textContent = (percentage >= 75) ? "ЁЯОЙ ро╡ро╛ро┤рпНродрпНродрпБроХрпНроХро│рпН! ЁЯОЙ" : "ЁЯСП роиро▓рпНро▓ роорпБропро▒рпНроЪро┐! ЁЯСП";
      scoreEl.textContent = `роЙроЩрпНроХро│рпН роородро┐рокрпНрокрпЖрогрпН: ${score} / ${totalQuestions}`;
      percentageEl.textContent = `ро╡ро┐ро┤рпБроХрпНроХро╛роЯрпБ: ${percentage}%`;
      messageEl.textContent = getMotivationalMessage(percentage);

      resultsContainer.style.display = 'block';

      saveQuizResult(quizTitle, score, totalQuestions, percentage);
    }
    
    // --- (рокро┐ройрпНро╡ро░рпБроорпН роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпН login, dashboard, save... роЗро╡ро▒рпНро▒рпБроХрпНроХро╛ройро╡рпИ) ---

    function checkLogin() {
      const user = localStorage.getItem('quizUser');
      if (user) {
        showApp();
      } else {
        showLogin();
      }
    }

    function showLogin() {
      loginContainer.classList.remove('hidden');
      appContainer.classList.add('hidden');
    }

    function showApp() {
      loginContainer.classList.add('hidden');
      appContainer.classList.remove('hidden');
      const userData = JSON.parse(localStorage.getItem('quizUser'));
      welcomeMessageEl.textContent = `ЁЯУИ роОройрпН роорпБропро▒рпНроЪро┐роХро│рпН (ро╡рогроХрпНроХроорпН, ${userData.name}!)`;
      loadDashboardData();
    }

    function saveQuizResult(title, score, total, percentage) {
      let history = JSON.parse(localStorage.getItem('quizHistory')) || [];
      const newResult = {
        title: title,
        score: score,
        total: total,
        percentage: percentage,
        date: new Date().toLocaleString('ta-IN')
      };
      history.unshift(newResult);
      localStorage.setItem('quizHistory', JSON.stringify(history));
      loadDashboardData();
    }

    function loadDashboardData() {
      let history = JSON.parse(localStorage.getItem('quizHistory')) || [];
      historyTableBodyEl.innerHTML = ""; 
      if (history.length === 0) {
        noHistoryMsgEl.style.display = "block";
        historyTableBodyEl.style.display = "none";
        statTotalAttemptsEl.textContent = "0";
        statAvgScoreEl.textContent = "0%";
      } else {
        noHistoryMsgEl.style.display = "none";
        historyTableBodyEl.style.display = "";
        let totalPercentage = 0;
        history.forEach(result => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${result.date}</td>
            <td>${result.title}</td>
            <td><strong>${result.score} / ${result.total}</strong> (${result.percentage}%)</td>
          `;
          historyTableBodyEl.appendChild(row);
          totalPercentage += result.percentage;
        });
        const avgScore = Math.round(totalPercentage / history.length);
        statTotalAttemptsEl.textContent = history.length;
        statAvgScoreEl.textContent = `${avgScore}%`;
      }
    }

    document.getElementById('tv-restart-btn').addEventListener('click', () => {
        stopTimer(); // ЁЯСС роорпКродрпНрод роирпЗро░роЩрпНроХро╛роЯрпНроЯро┐ропрпИ роиро┐ро▒рпБродрпНродрпБ ЁЯСС
        stopInactivityTimer(); // ЁЯСС роЪрпЖропро▓рпНрокроЯро╛ роиро┐ро▓рпИ роирпЗро░роЩрпНроХро╛роЯрпНроЯро┐ропрпИ роиро┐ро▒рпБродрпНродрпБ ЁЯСС

        document.getElementById('tv-results').style.display = 'none';
        document.getElementById('tv-progress').style.display = 'none';
        document.getElementById('tv-question').style.display = 'none';
        document.getElementById('tv-options').innerHTML = '';
        document.getElementById('tv-feedback').style.display = 'none';
        
        const timerBox = document.getElementById('tv-timer-box');
        if (timerBox) timerBox.style.display = 'none';

        document.getElementById('quizSelect').selectedIndex = 0;
    });

    loginBtn.addEventListener('click', () => {
      const username = usernameInput.value.trim();
      if (username === "") {
        alert("Please enter your name (роЙроЩрпНроХро│рпН рокрпЖропро░рпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН)");
        return;
      }
      const userData = { name: username };
      localStorage.setItem('quizUser', JSON.stringify(userData));
      if (!localStorage.getItem('quizHistory')) {
        localStorage.setItem('quizHistory', JSON.stringify([]));
      }
      showApp();
    });

    logoutBtn.addEventListener('click', () => {
      if (confirm("ро╡рпЖро│ро┐ропрпЗро▒ ро╡ро┐ро░рпБроорпНрокрпБроХро┐ро▒рпАро░рпНроХро│ро╛? роЙроЩрпНроХро│рпН роородро┐рокрпНрокрпЖрогрпН ро╡ро░ро▓ро╛ро▒рпБ роЕройрпИродрпНродрпБроорпН роирпАроХрпНроХрокрпНрокроЯрпБроорпН.")) {
        stopTimer(); // ЁЯСС роорпКродрпНрод роирпЗро░роЩрпНроХро╛роЯрпНроЯро┐ропрпИ роиро┐ро▒рпБродрпНродрпБ ЁЯСС
        stopInactivityTimer(); // ЁЯСС роЪрпЖропро▓рпНрокроЯро╛ роиро┐ро▓рпИ роирпЗро░роЩрпНроХро╛роЯрпНроЯро┐ропрпИ роиро┐ро▒рпБродрпНродрпБ ЁЯСС
        localStorage.removeItem('quizUser');
        localStorage.removeItem('quizHistory');
        window.location.reload();
      }
    });

    document.addEventListener('DOMContentLoaded', checkLogin);

  </script>
</body>
</html>
